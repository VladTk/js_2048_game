const t=document.querySelector(".game-field").querySelectorAll(".field-cell"),e=document.querySelector(".button"),s=document.querySelector(".game-score"),a=document.querySelector(".message-lose"),r=document.querySelector(".message-win"),i=document.querySelector(".message-start");var l={};class o{static GAME_STATUS={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=o.GAME_STATUS.idle,this.initialState=t,this.state=t.map(t=>[...t]),this.score=0}moveLeft(){if(this.status!==o.GAME_STATUS.playing)return;let t=this.state.map(t=>this.#t(t,"left"));this.#e(t)}moveRight(){if(this.status!==o.GAME_STATUS.playing)return;let t=this.state.map(t=>this.#t(t,"right"));this.#e(t)}moveUp(){if(this.status!==o.GAME_STATUS.playing)return;let t=this.#s(this.state).map(t=>this.#t(t,"left")),e=this.#s(t);this.#e(e)}moveDown(){if(this.status!==o.GAME_STATUS.playing)return;let t=this.#s(this.state).map(t=>this.#t(t,"right")),e=this.#s(t);this.#e(e)}#t(t,e="left"){let s=t.filter(t=>0!==t);if("left"===e)for(let t=0;t<s.length-1;t++)s[t]===s[t+1]&&(s[t]*=2,s[t+1]=0,this.score+=s[t]);else for(let t=s.length-1;t>0;t--)s[t]===s[t-1]&&(s[t]*=2,s[t-1]=0,this.score+=s[t]);return(s=s.filter(t=>0!==t),"left"===e)?[...s,...Array(t.length-s.length).fill(0)]:[...Array(t.length-s.length).fill(0),...s]}#e(t){let e=!1;t.forEach((t,s)=>{t.forEach((t,a)=>{t!==this.state[s][a]&&(e=!0)})}),this.setState(t),e&&this.addCell(),this.updateStatus()}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}setState(t){this.state=t.map(t=>[...t])}#s(t){return t[0].map((e,s)=>t.map(t=>t[s]))}updateStatus(){let t=!1,e=!1,s=!1;if(this.state.forEach((a,r)=>{a.forEach((i,l)=>{2048===i&&(t=!0),0===i&&(s=!0),r<this.state.length-1&&i===this.state[r+1][l]&&(e=!0),l<a.length-1&&i===this.state[r][l+1]&&(e=!0)})}),t){this.status=o.GAME_STATUS.win;return}e||s||(this.status=o.GAME_STATUS.lose)}addCell(){let t=[];for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)0===this.state[e][s]&&t.push({row:e,col:s});if(0===t.length)return;let e=Math.floor(Math.random()*t.length),s=t[e];this.state[s.row][s.col]=.9>Math.random()?2:4}start(){this.status=o.GAME_STATUS.playing,this.addCell(),this.addCell()}restart(){this.status=o.GAME_STATUS.idle,this.state=this.initialState.map(t=>[...t]),this.score=0}}const n=new(l=o);e.addEventListener("click",()=>{n.getStatus()===l.GAME_STATUS.idle?(n.start(),e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart",i.classList.add("hidden")):(n.restart(),r.classList.add("hidden"),a.classList.add("hidden"),i.classList.remove("hidden"),e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start"),d(t),c(s),S(),document.addEventListener("keydown",h)});const h=e=>{switch(e.preventDefault(),e.key){case"ArrowUp":n.moveUp();break;case"ArrowRight":n.moveRight();break;case"ArrowDown":n.moveDown();break;case"ArrowLeft":n.moveLeft()}d(t),c(s),S()},c=t=>{t.textContent=n.getScore()},d=t=>{let e=n.getState().flat();t.forEach((t,s)=>{t.textContent="",t.className="field-cell",e[s]&&(t.textContent=e[s],t.className=`field-cell field-cell--${e[s]}`)})},S=()=>{let t=n.getStatus();t===l.GAME_STATUS.win&&(r.classList.remove("hidden"),document.removeEventListener("keydown",h)),t===l.GAME_STATUS.lose&&(a.classList.remove("hidden"),document.removeEventListener("keydown",h))};
//# sourceMappingURL=index.91188aa9.js.map
